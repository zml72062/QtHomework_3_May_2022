# 「保卫 4.0」游戏

<p align="right">——《程序设计实习》大作业</p>

## 一、程序功能介绍

本游戏为北京大学《程序设计实习》课程的一次大作业，使用 Qt 开发.

### 玩法简介

游戏共有 8 个关卡，分别对应大一上学期到大四下学期，关卡难度逐渐上升，玩家需要依次通过八个关卡才能通关。

在每个关卡中，敌人会从起点根据给定的路线前往终点，在终点处会有一个 4.0 标识。关卡中的一些位置会出现漏洞，玩家可以在漏洞上花费学分绩建造不同的 bug，当敌人经过bug时，每种 bug 能够对不同的敌人产生不同的效果（比如减速、减少生命值）。每杀掉一个敌人，敌人会掉落学分绩。玩家的目的就是尽可能地阻止敌人到达终点的 4.0。每个关卡中存在 4.0 率上限，若敌人拿到 4.0 的比例超过 4.0 率上限时，游戏失败。

* 游戏中玩家可以建造的 bug 一览如下:

|类型	|说明	|对敌人的效果|	价格（相对）|
|:---|:---|:---|:---|
|WA|	糟糕,有case过不了,所有单位需要进行debug| 单体伤害 |1|
|TLE|	Python系单位永远对TLE头大	|单体伤害，对Python类敌人伤害2，对C类和卷类敌人伤害0.5|	1|
|CE|	C系单位忘不了数十个Error扑面而来的恐惧| 单体伤害，对C类敌人伤害2，对Python类和卷类敌人伤害0.5 |	1|
|PE|	呵，小bug！不急不急慢慢debug| 无法造成伤害，但会使敌人减速 |	0.5|
|RTE|	你永远不知道你的代码和编译器干了什么| 秒杀C类单位和菜类单位，但对Python类单位和卷类单位无效 |	2|

* 游戏中需要击败的敌人一览如下:

|类型|	说明|	移动速度	|血量|	特殊技能|
|:---|:---|:---|:---|:---|
|C类学生|	C语言是全世界最好的语言|	快|	低||
|Python类学生|	Python是全世界最好的语言|	慢|	高||
|啥都会的卷王（卷类学生）|	百bug不侵| 快 |	高|  |
|跨院系选课的菜鸡（菜类学生）|	呜呜呜中期退课怎么截止了|	慢|	低|	被杀死掉落学分绩*2|



## 二、项目各模块与类设计细节

### 1.主界面：MainWindow类

![1](C:\Users\Charming\Desktop\tool-kit\工具人文件夹2\1.png)

主界面由标题，开始游戏按钮和退出按钮构成。当玩家点击退出按钮时，游戏会退出；当玩家点击开始游戏按钮时，玩家会进入一个选择关卡界面。

### 2.关卡界面：Levels类

![2](C:\Users\Charming\Desktop\tool-kit\工具人文件夹2\2.png)

选择关卡界面由标题，进度条，八个关卡和退出按钮组成。当玩家点击退出按钮时，玩家会返回主界面；当玩家点击关卡按钮时，玩家会进入相应的关卡。游戏中的八个关卡分别命名为大一上学期到大四下学期，只有通过了前一个关卡玩家才可以进入下一个关卡。右上角的进度条代表了玩家的通关进度。

### 3.游戏界面：GameLevel类

![3](C:\Users\Charming\Desktop\tool-kit\工具人文件夹2\3.png)

游戏界面的左上方是剩余GPA数量，即游戏内的货币；右上方是游戏进度条，代表了当前游戏进度，每杀掉一个敌人，游戏进度就会增加；游戏的下方代表了5种防御塔（bug）和它们的费用；游戏的中间部分则是游戏的内容界面。在游戏的内容界面中，灰色的方格代表障碍物，红色的方格代表了可建造防御塔的点位，没有方格的地方和红色的方格连起来形成了敌人的行动路线。游戏中左方为敌人的入口，右方绿色4.0的按钮为敌人的出口，玩家可以拖动下方的防御塔到红色塔位上来对敌人进行防御。

### 4.敌人：EnemyBase类及其派生类

游戏中共有4种敌人，每种敌人自属一个Enemy类，它们共同继承于一个基类：EnemyBase类。在每个EnemyBase对象初始化的时候，需要提供敌人行走路线，即一系列坐标点位，并将敌人的初始位置设置为起点位，将初始行走方向设置为下一个坐标的方向。一个EnemyBase类设有move函数和findNewDirection函数，其中move函数在游戏界面更新一帧时调用，每个敌人朝着当前方向行走一步，若敌人走到了某个坐标点位，则寻找下一个坐标点位，并用findNewDirection函数来寻找下一个行走方向。

### 5.游戏运行机制

在关卡界面类中储存了每个关卡的信息，包括游戏地图、敌人数量等等，这些信息在不同关卡下是不一样的。当玩家选择了对应的关卡，Levels类就会把对应的关卡信息发送到GameLevel类的初始化列表中。

在GameLevel类中，设计了两个定时器：游戏帧定时器和出怪定时器。游戏中设有两个列表：enemyList和enemyWaitlist，其中前者代表进入游戏的敌人，而后者代表等待放入游戏的敌人。游戏初始化时enemyWaitlist存储了关卡的所有敌人，而enemyList为空，在每个游戏帧定时器计时结束后，游戏界面将会刷新一帧，具体地，即是每个enemyList列表中敌人向前行走一步，并重新画出每个敌人当前的位置。而当出怪定时器计时结束的时候，如果enemyWaitlist列表中还有敌人，就从enemyWaitlist列表中将一个敌人放至enemyList列表中。

在敌人类中，设计了reached信号和die信号，每当敌人到达一个目标点位（i，j），就会发送reached(i,j) 信号，这个信号将被连接到beAttacked槽和clearIcon槽，beAttacked槽接受敌人达到的目标点位（i，j），并检测（i，j）上是否有防御塔（bug），如果有防御塔，则该防御塔会对敌人造成伤害（或减速）；clearIcon会清除该点位上的防御塔（bug）（如果有的话）。当敌人生命值降为0或速度降为0时将会发送die信号，这个信号连接到clear槽，会将该敌人从敌人列表中删除。此外，敌人类还有一个attacked信号，当敌人侵入终点时，就会发送信号emit()。

在GameLevel类中，编写了两个private函数generateStarts和generatePaths，用于根据地图生成敌人的起点和前进的路径。除上面所述的clear槽和clearIcon槽外，还有一个commentWin槽，其作用是当一关胜利之后弹出 “游戏胜利” 窗口。这个槽与GameLevel类中的win信号相连接，以传递游戏胜利信号。

## 三、小组成员分工情况

马允轩：负责设计和编写EnemyBase类及其派生类，游戏界面GameLevel类中的敌人组件运动效果，以及游戏地图、敌人特性、防御塔特性的设计

周俊汝：负责设计和编写主界面MainWindow类，关卡界面Levels类，游戏界面GameLevel类中的静态组件及其与EnemyBase类对象的交互

## 四、项目总结与反思


